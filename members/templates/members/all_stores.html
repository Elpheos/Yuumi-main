{% extends "master.html" %}
{% load static %}

{% block title %}
   Yuumi | {{ ville }}
{% endblock %}

{% block content %}

<style>
.derniers-arrivants-grid-commerces {
    background-color: #ff8b38;
    padding: 0 0 20px 0;
    display: flex;
}

.derniers-arrivants-grid-commerces a {
    display: flex;
    flex-direction: column;
    width: 100%;
    text-decoration: none;
}

.derniers-arrivants-grid-commerces .img-wrapper {
    width: 100%;
    height: 260px;
    overflow: hidden;
}

.derniers-arrivants-grid-commerces .img-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.derniers-arrivants-grid-commerces h4 {
    margin: 12px 8px 0 8px;
    text-align: center;
    color: white;
    font-size: 1.1rem;
}
</style>

<main>

    <!-- ======================= MISE EN AVANT ======================= -->
    <section aria-label="commerces mis en avant">
        <div class="mise-en-avant-annecy-container">
            {% with image_path='images/'|add:ville|lower|add:'/base-annecy.jpg' %}
                <img class="mise-en-avant-annecy-image"
                     src="{% static image_path %}" />
            {% endwith %}

            <div class="mise-en-avant-annecy-text-container">
                <h2>Signorini Tartufi</h2>
                <h3>Épicerie spécialisée</h3>
            </div>

            <a class="mise-en-avant-bouton" href="#" rel="noopener">
                découvrir
            </a>
        </div>
    </section>


    <!-- ======================= CATEGORIES ======================= -->
    <section aria-label="Liste des catégories">
        <div class="liste-des-catégories-container">

            <div class="titre-page-annecy-container">
                <h2>Que cherchez-vous ?</h2>
                <h3>
                    Un commerce avec des produits de qualité, un restaurant qui vous offrira un bon moment.
                </h3>
            </div>

            <div class="liste-des-categories-grid-container">

                {% for item in city_category_items %}

                    <div class="grid-image-{{ forloop.counter }}-container">
                        <a 
                        {% if item.category %}
                            href="{% url 'by_category' departement ville item.category.slug %}"
                        {% elif item.super_category %}
                            href="{% url 'by_super_category' departement ville item.super_category.slug %}"
                        {% endif %}
                        rel="noopener">

                            {% if item.category %}
                                {% if item.category.image %}
                                    <img src="{{ item.category.image.url }}" alt="{{ item.category.name }}">
                                {% else %}
                                    <img src="{% static 'placeholder.png' %}" alt="Pas d'image">
                                {% endif %}
                                <h3 class="grid-nom-categories">
                                    {{ item.category.name }}
                                </h3>

                            {% elif item.super_category %}
                                {% if item.super_category.image %}
                                    <img src="{{ item.super_category.image.url }}" alt="{{ item.super_category.name }}">
                                {% else %}
                                    <img src="{% static 'placeholder.png' %}" alt="Pas d'image">
                                {% endif %}
                                <h3 class="grid-nom-categories">
                                    {{ item.super_category.name }}
                                </h3>
                            {% endif %}

                        </a>
                    </div>

                {% empty %}
                    <p>Aucune catégorie configurée pour cette ville.</p>
                {% endfor %}

            </div>

            <div class="liste-des-categories-button-container">
                <a class="liste-des-categories-button"
                   href="{% url 'categories_ville' departement ville %}"
                   rel="noopener">
                    Toutes les catégories
                </a>
            </div>

        </div>

        <hr class="hr-separator"/>
    </section>


    <!-- ======================= DERNIERS ARRIVANTS ======================= -->
    <section aria-label="les derniers arrivants">
        <div class="derniers-arrivants-container">

            <div class="titre-page-annecy-container">
                <h2>Les derniers arrivants</h2>
                <h3>Ils viennent de nous rejoindre ! Pensez à y jeter un œil.</h3>
            </div>

            <div class="derniers-arrivants-grid-container">
                {% for store in derniers_arrivants %}
                    <div class="derniers-arrivants-grid-commerces">
                        <a href="{% url 'store_details' departement=store.departement ville=store.ville slug=store.slug %}"
                           rel="noopener">

                            <div class="img-wrapper">
                                {% if store.photo %}
                                    <img src="{{ store.photo.url }}" alt="Photo de {{ store.nom }}">
                                {% else %}
                                    <img src="{% static 'placeholder.png' %}" alt="Pas de photo">
                                {% endif %}
                            </div>

                            <h4>{{ store.nom }}</h4>
                        </a>
                    </div>
                {% empty %}
                    <p>Aucun commerce récemment ajouté.</p>
                {% endfor %}
            </div>

        </div>
    </section>

</main>

{% endblock %}
